#include "../techniques.hpp"
#include "../../types.hpp"
#include "../../modules/util.hpp"
#include "../../modules/cpu.hpp"
#include "../../includes.hpp"

/**
 * @brief Check for AMD CPU thread count database if it matches the system's thread count
 * @link https://www.amd.com/en/products/specifications/processors.html
 * @category x86
 * @implements VM::AMD_THREAD_MISMATCH
 */
[[nodiscard]] bool techniques::amd_thread_mismatch() {
#if (!x86)
    return false;
#else
    if (!cpu::is_amd()) {
        return false;
    }

    if (cpu::has_hyperthreading()) {
        return false;
    }
    
    std::string model = cpu::get_brand();

    for (char& c : model) {
        c = static_cast<char>(std::tolower(c));
    }

    util::debug("AMD_THREAD_MISMATCH: CPU model = ", model);

    // all of these have spaces at the end on purpose, because some of these could 
    // accidentally match different brands. Like for example: "a10-6700" could be 
    // detected when scanning the string in "a10-6700t", which are both different 
    // and obviously incorrect. So to fix this, spaces are added at the end.
    constexpr std::array<std::pair<const char*, int>, 559> amd_thread_database = { {
        { "3015ce ", 4 },
        { "3015e ", 4 },
        { "3020e ", 2 },
        { "860k ", 4 },
        { "870k ", 4 },
        { "a10 pro-7350b ", 4 },
        { "a10 pro-7800b ", 4 },
        { "a10 pro-7850b ", 4 },
        { "a10-6700 ", 4 },
        { "a10-6700t ", 4 },
        { "a10-6790b ", 4 },
        { "a10-6790k ", 4 },
        { "a10-6800b ", 4 },
        { "a10-6800k ", 4 },
        { "a10-7300 ", 4 },
        { "a10-7400p ", 4 },
        { "a10-7700k ", 4 },
        { "a10-7800 ", 4 },
        { "a10-7850k ", 4 },
        { "a10-7860k ", 4 },
        { "a10-7870k ", 4 },
        { "a10-8700b ", 4 },
        { "a10-8700p ", 4 },
        { "a10-8750b ", 4 },
        { "a10-8850b ", 4 },
        { "a12-8800b ", 4 },
        { "a4 micro-6400t ", 4 },
        { "a4 pro-3340b ", 4 },
        { "a4 pro-3350b ", 4 },
        { "a4 pro-7300b ", 2 },
        { "a4 pro-7350b ", 2 },
        { "a4-5000 ", 4 },
        { "a4-5100 ", 4 },
        { "a4-6210 ", 4 },
        { "a4-6300 ", 2 },
        { "a4-6320 ", 2 },
        { "a4-7210 ", 4 },
        { "a4-7300 ", 2 },
        { "a4-8350b ", 2 },
        { "a4-9120c ", 2 },
        { "a6 pro-7050b ", 2 },
        { "a6 pro-7400b ", 2 },
        { "a6-5200 ", 4 },
        { "a6-5200m ", 4 },
        { "a6-5350m ", 2 },
        { "a6-6310 ", 4 },
        { "a6-6400b ", 2 },
        { "a6-6400k ", 2 },
        { "a6-6420b ", 2 },
        { "a6-6420k ", 2 },
        { "a6-7000 ", 2 },
        { "a6-7310 ", 4 },
        { "a6-7400k ", 2 },
        { "a6-8500b ", 4 },
        { "a6-8500p ", 2 },
        { "a6-8550b ", 2 },
        { "a6-9220c ", 2 },
        { "a8 pro-7150b ", 4 },
        { "a8 pro-7600b ", 4 },
        { "a8-6410 ", 4 },
        { "a8-6500 ", 4 },
        { "a8-6500b ", 4 },
        { "a8-6500t ", 4 },
        { "a8-6600k ", 4 },
        { "a8-7100 ", 4 },
        { "a8-7200p ", 4 },
        { "a8-7410 ", 4 },
        { "a8-7600 ", 4 },
        { "a8-7650k ", 4 },
        { "a8-7670k ", 4 },
        { "a8-8600b ", 4 },
        { "a8-8600p ", 4 },
        { "a8-8650b ", 4 },
        { "ai 5 340 ", 12 },
        { "ai 5 pro 340 ", 12 },
        { "ai 7 350 ", 16 },
        { "ai 7 pro 350 ", 16 },
        { "ai 7 pro 360 ", 16 },
        { "ai 9 365 ", 20 },
        { "ai 9 hx 370 ", 24 },
        { "ai 9 hx 375 ", 24 },
        { "ai 9 hx pro 370 ", 24 },
        { "ai 9 hx pro 375 ", 24 },
        { "ai max 385 ", 16 },
        { "ai max 390 ", 24 },
        { "ai max pro 380 ", 12 },
        { "ai max pro 385 ", 16 },
        { "ai max pro 390 ", 24 },
        { "ai max+ 395 ", 32 },
        { "ai max+ pro 395 ", 32 },
        { "athlon  silver 3050c ", 2 }, // there's an extra space in the AMD specifications for some reason, which I assume it's a typo. I added the fixed and typo'd version just in case.
        { "athlon silver 3050c ", 2 },
        { "athlon 200ge ", 4 },
        { "athlon 220ge ", 4 },
        { "athlon 240ge ", 4 },
        { "athlon 255e ", 2 },
        { "athlon 3000g ", 4 },
        { "athlon 300ge ", 4 },
        { "athlon 300u ", 4 },
        { "athlon 320ge ", 4 },
        { "athlon 425e ", 3 },
        { "athlon 460 ", 3 },
        { "athlon 5150 ", 4 },
        { "athlon 5350 ", 4 },
        { "athlon 5370 ", 4 },
        { "athlon 620e ", 4 },
        { "athlon 631 ", 4 },
        { "athlon 638 ", 4 },
        { "athlon 641 ", 4 },
        { "athlon 740 ", 4 },
        { "athlon 750k ", 4 },
        { "athlon 760k ", 4 },
        { "athlon 860k ", 4 },
        { "athlon gold 3150c ", 4 },
        { "athlon gold 3150g ", 4 },
        { "athlon gold 3150ge ", 4 },
        { "athlon gold 3150u ", 4 },
        { "athlon gold 7220c ", 4 },
        { "athlon gold 7220u ", 4 },
        { "athlon gold pro 3150g ", 4 },
        { "athlon gold pro 3150ge ", 4 },
        { "athlon pro 200ge ", 4 },
        { "athlon pro 200u ", 4 },
        { "athlon pro 300ge ", 4 },
        { "athlon pro 300u ", 4 },
        { "athlon pro 3045b ", 2 },
        { "athlon pro 3145b ", 4 },
        { "athlon silver 3050e ", 4 },
        { "athlon silver 3050ge ", 4 },
        { "athlon silver 3050u ", 2 },
        { "athlon silver 7120c ", 2 },
        { "athlon silver 7120u ", 2 },
        { "athlon silver pro 3125ge ", 4 },
        { "athlon x4 940 ", 4 },
        { "athlon x4 950 ", 4 },
        { "athlon x4 970 ", 4 },
        { "b57 ", 2 },
        { "b59 ", 2 },
        { "b60 ", 2 },
        { "b75 ", 3 },
        { "b77 ", 3 },
        { "b97 ", 4 },
        { "b99 ", 4 },
        { "e1 micro-6200t ", 2 },
        { "e1-2100 ", 2 },
        { "e1-2200 ", 2 },
        { "e1-2500 ", 2 },
        { "e1-6010 ", 2 },
        { "e1-7010 ", 2 },
        { "e2-3000 ", 2 },
        { "e2-3800 ", 4 },
        { "e2-6110 ", 4 },
        { "e2-7110 ", 4 },
        { "fx 6100 ", 6 },
        { "fx-4100 ", 4 },
        { "fx-4130 ", 4 },
        { "fx-4170 ", 4 },
        { "fx-4300 ", 4 },
        { "fx-4320 ", 4 },
        { "fx-4350 ", 4 },
        { "fx-6200 ", 6 },
        { "fx-6300 ", 6 },
        { "fx-6350 ", 6 },
        { "fx-7500 ", 4 },
        { "fx-7600p ", 4 },
        { "fx-8120 ", 8 },
        { "fx-8150 ", 8 },
        { "fx-8300 ", 8 },
        { "fx-8310 ", 8 },
        { "fx-8320 ", 8 },
        { "fx-8320e ", 8 },
        { "fx-8350 ", 8 },
        { "fx-8370 ", 8 },
        { "fx-8370e ", 8 },
        { "fx-8800p ", 4 },
        { "fx-9370 ", 8 },
        { "fx-9590 ", 8 },
        { "micro-6700t ", 4 },
        { "n640 ", 2 },
        { "n660 ", 2 },
        { "n870 ", 3 },
        { "n960 ", 4 },
        { "n970 ", 4 },
        { "p650 ", 2 },
        { "p860 ", 3 },
        { "phenom ii 1075t ", 6 },
        { "phenom ii 555 ", 2 },
        { "phenom ii 565 ", 2 },
        { "phenom ii 570 ", 2 },
        { "phenom ii 840 ", 4 },
        { "phenom ii 850 ", 4 },
        { "phenom ii 960t ", 4 },
        { "phenom ii 965 ", 4 },
        { "phenom ii 975 ", 4 },
        { "phenom ii 980 ", 4 },
        { "ryzen 3 1200 ", 4 },
        { "ryzen 3 1300x ", 4 },
        { "ryzen 3 210 ", 8 },
        { "ryzen 3 2200g ", 4 },
        { "ryzen 3 2200ge ", 4 },
        { "ryzen 3 2200u ", 4 },
        { "ryzen 3 2300u ", 4 },
        { "ryzen 3 2300x ", 4 },
        { "ryzen 3 3100 ", 8 },
        { "ryzen 3 3200g ", 4 },
        { "ryzen 3 3200ge ", 4 },
        { "ryzen 3 3200u ", 4 },
        { "ryzen 3 3250c ", 4 },
        { "ryzen 3 3250u ", 4 },
        { "ryzen 3 3300u ", 4 },
        { "ryzen 3 3300x ", 8 },
        { "ryzen 3 3350u ", 4 },
        { "ryzen 3 4100 ", 8 },
        { "ryzen 3 4300g ", 8 },
        { "ryzen 3 4300ge ", 8 },
        { "ryzen 3 4300u ", 4 },
        { "ryzen 3 5125c ", 4 },
        { "ryzen 3 5300g ", 8 },
        { "ryzen 3 5300ge ", 8 },
        { "ryzen 3 5300u ", 8 },
        { "ryzen 3 5305g ", 8 },
        { "ryzen 3 5305ge ", 8 },
        { "ryzen 3 5400u ", 8 },
        { "ryzen 3 5425c ", 8 },
        { "ryzen 3 5425u ", 8 },
        { "ryzen 3 7320c ", 8 },
        { "ryzen 3 7320u ", 8 },
        { "ryzen 3 7330u ", 8 },
        { "ryzen 3 7335u ", 8 },
        { "ryzen 3 7440u ", 8 },
        { "ryzen 3 8300g ", 8 },
        { "ryzen 3 8300ge ", 8 },
        { "ryzen 3 8440u ", 8 },
        { "ryzen 3 pro 1200 ", 4 },
        { "ryzen 3 pro 1300 ", 4 },
        { "ryzen 3 pro 210 ", 8 },
        { "ryzen 3 pro 2200g ", 4 },
        { "ryzen 3 pro 2200ge ", 4 },
        { "ryzen 3 pro 2300u ", 4 },
        { "ryzen 3 pro 3200g ", 4 },
        { "ryzen 3 pro 3200ge ", 4 },
        { "ryzen 3 pro 3300u ", 4 },
        { "ryzen 3 pro 4350g ", 8 },
        { "ryzen 3 pro 4350ge ", 8 },
        { "ryzen 3 pro 4355g ", 8 },
        { "ryzen 3 pro 4355ge ", 8 },
        { "ryzen 3 pro 4450u ", 8 },
        { "ryzen 3 pro 5350g ", 8 },
        { "ryzen 3 pro 5350ge ", 8 },
        { "ryzen 3 pro 5355g ", 8 },
        { "ryzen 3 pro 5355ge ", 8 },
        { "ryzen 3 pro 5450u ", 8 },
        { "ryzen 3 pro 5475u ", 8 },
        { "ryzen 3 pro 7330u ", 8 },
        { "ryzen 3 pro 7335u ", 8 },
        { "ryzen 3 pro 8300g ", 8 },
        { "ryzen 3 pro 8300ge ", 8 },
        { "ryzen 5 1400 ", 8 },
        { "ryzen 5 1500x ", 8 },
        { "ryzen 5 1600 ", 12 },
        { "ryzen 5 1600 (af )", 12 },
        { "ryzen 5 1600x ", 12 },
        { "ryzen 5 220 ", 12 },
        { "ryzen 5 230 ", 12 },
        { "ryzen 5 240 ", 12 },
        { "ryzen 5 2400g ", 8 },
        { "ryzen 5 2400ge ", 8 },
        { "ryzen 5 2500u ", 8 },
        { "ryzen 5 2500x ", 8 },
        { "ryzen 5 2600 ", 12 },
        { "ryzen 5 2600e ", 12 },
        { "ryzen 5 2600h ", 8 },
        { "ryzen 5 2600x ", 12 },
        { "ryzen 5 3400g ", 8 },
        { "ryzen 5 3400ge ", 8 },
        { "ryzen 5 3450u ", 8 },
        { "ryzen 5 3500 ", 6 },
        { "ryzen 5 3500c ", 8 },
        { "ryzen 5 3500u ", 8 },
        { "ryzen 5 3550h ", 8 },
        { "ryzen 5 3580u ", 8 },
        { "ryzen 5 3600 ", 12 },
        { "ryzen 5 3600x ", 12 },
        { "ryzen 5 3600xt ", 12 },
        { "ryzen 5 4500 ", 12 },
        { "ryzen 5 4500u ", 6 },
        { "ryzen 5 4600g ", 12 },
        { "ryzen 5 4600ge ", 12 },
        { "ryzen 5 4600h ", 12 },
        { "ryzen 5 4600u ", 12 },
        { "ryzen 5 4680u ", 12 },
        { "ryzen 5 5500 ", 12 },
        { "ryzen 5 5500gt ", 12 },
        { "ryzen 5 5500h ", 8 },
        { "ryzen 5 5500u ", 12 },
        { "ryzen 5 5560u ", 12 },
        { "ryzen 5 5600 ", 12 },
        { "ryzen 5 5600g ", 12 },
        { "ryzen 5 5600ge ", 12 },
        { "ryzen 5 5600gt ", 12 },
        { "ryzen 5 5600h ", 12 },
        { "ryzen 5 5600hs ", 12 },
        { "ryzen 5 5600t ", 12 },
        { "ryzen 5 5600u ", 12 },
        { "ryzen 5 5600x ", 12 },
        { "ryzen 5 5600x3d ", 12 },
        { "ryzen 5 5600xt ", 12 },
        { "ryzen 5 5605g ", 12 },
        { "ryzen 5 5605ge ", 12 },
        { "ryzen 5 5625c ", 12 },
        { "ryzen 5 5625u ", 12 },
        { "ryzen 5 6600h ", 12 },
        { "ryzen 5 6600hs ", 12 },
        { "ryzen 5 6600u ", 12 },
        { "ryzen 5 7235hs ", 8 },
        { "ryzen 5 7400f ", 12 },
        { "ryzen 5 7430u ", 12 },
        { "ryzen 5 7500f ", 12 },
        { "ryzen 5 7520c ", 8 },
        { "ryzen 5 7520u ", 8 },
        { "ryzen 5 7530u ", 12 },
        { "ryzen 5 7535hs ", 12 },
        { "ryzen 5 7535u ", 12 },
        { "ryzen 5 7540u ", 12 },
        { "ryzen 5 7545u ", 12 },
        { "ryzen 5 7600 ", 12 },
        { "ryzen 5 7600x ", 12 },
        { "ryzen 5 7600x3d ", 12 },
        { "ryzen 5 7640hs ", 12 },
        { "ryzen 5 7640u ", 12 },
        { "ryzen 5 7645hx ", 12 },
        { "ryzen 5 8400f ", 12 },
        { "ryzen 5 8500g ", 12 },
        { "ryzen 5 8500ge ", 12 },
        { "ryzen 5 8540u ", 12 },
        { "ryzen 5 8600g ", 12 },
        { "ryzen 5 8640hs ", 12 },
        { "ryzen 5 8640u ", 12 },
        { "ryzen 5 8645hs ", 12 },
        { "ryzen 5 9600 ", 12 },
        { "ryzen 5 9600x ", 12 },
        { "ryzen 5 pro 1500 ", 8 },
        { "ryzen 5 pro 1600 ", 12 },
        { "ryzen 5 pro 220 ", 12 },
        { "ryzen 5 pro 230 ", 12 },
        { "ryzen 5 pro 2400g ", 8 },
        { "ryzen 5 pro 2400ge ", 8 },
        { "ryzen 5 pro 2500u ", 8 },
        { "ryzen 5 pro 2600 ", 12 },
        { "ryzen 5 pro 3350g ", 8 },
        { "ryzen 5 pro 3350ge ", 4 },
        { "ryzen 5 pro 3400g ", 8 },
        { "ryzen 5 pro 3400ge ", 8 },
        { "ryzen 5 pro 3500u ", 8 },
        { "ryzen 5 pro 3600 ", 12 },
        { "ryzen 5 pro 4650g ", 12 },
        { "ryzen 5 pro 4650ge ", 12 },
        { "ryzen 5 pro 4650u ", 12 },
        { "ryzen 5 pro 4655g ", 12 },
        { "ryzen 5 pro 4655ge ", 12 },
        { "ryzen 5 pro 5645 ", 12 },
        { "ryzen 5 pro 5650g ", 12 },
        { "ryzen 5 pro 5650ge ", 12 },
        { "ryzen 5 pro 5650u ", 12 },
        { "ryzen 5 pro 5655g ", 12 },
        { "ryzen 5 pro 5655ge ", 12 },
        { "ryzen 5 pro 5675u ", 12 },
        { "ryzen 5 pro 6650h ", 12 },
        { "ryzen 5 pro 6650hs ", 12 },
        { "ryzen 5 pro 6650u ", 12 },
        { "ryzen 5 pro 7530u ", 12 },
        { "ryzen 5 pro 7535u ", 12 },
        { "ryzen 5 pro 7540u ", 12 },
        { "ryzen 5 pro 7545u ", 12 },
        { "ryzen 5 pro 7640hs ", 12 },
        { "ryzen 5 pro 7640u ", 12 },
        { "ryzen 5 pro 7645 ", 12 },
        { "ryzen 5 pro 8500g ", 12 },
        { "ryzen 5 pro 8500ge ", 12 },
        { "ryzen 5 pro 8540u ", 12 },
        { "ryzen 5 pro 8600g ", 12 },
        { "ryzen 5 pro 8600ge ", 12 },
        { "ryzen 5 pro 8640hs ", 12 },
        { "ryzen 5 pro 8640u ", 12 },
        { "ryzen 5 pro 8645hs ", 12 },
        { "ryzen 7 1700 ", 16 },
        { "ryzen 7 1700x ", 16 },
        { "ryzen 7 1800x ", 16 },
        { "ryzen 7 250 ", 16 },
        { "ryzen 7 260 ", 16 },
        { "ryzen 7 2700 ", 16 },
        { "ryzen 7 2700e ", 16 },
        { "ryzen 7 2700u ", 8 },
        { "ryzen 7 2700x ", 16 },
        { "ryzen 7 2800h ", 8 },
        { "ryzen 7 3700c ", 8 },
        { "ryzen 7 3700u ", 8 },
        { "ryzen 7 3700x ", 16 },
        { "ryzen 7 3750h ", 8 },
        { "ryzen 7 3780u ", 8 },
        { "ryzen 7 3800x ", 16 },
        { "ryzen 7 3800xt ", 16 },
        { "ryzen 7 4700g ", 16 },
        { "ryzen 7 4700ge ", 16 },
        { "ryzen 7 4700u ", 8 },
        { "ryzen 7 4800h ", 16 },
        { "ryzen 7 4800hs ", 16 },
        { "ryzen 7 4800u ", 16 },
        { "ryzen 7 4980u ", 16 },
        { "ryzen 7 5700 ", 16 },
        { "ryzen 7 5700g ", 16 },
        { "ryzen 7 5700ge ", 16 },
        { "ryzen 7 5700u ", 16 },
        { "ryzen 7 5700x ", 16 },
        { "ryzen 7 5700x3d ", 16 },
        { "ryzen 7 5705g ", 16 },
        { "ryzen 7 5705ge ", 16 },
        { "ryzen 7 5800 ", 16 },
        { "ryzen 7 5800h ", 16 },
        { "ryzen 7 5800hs ", 16 },
        { "ryzen 7 5800u ", 16 },
        { "ryzen 7 5800x ", 16 },
        { "ryzen 7 5800x3d ", 16 },
        { "ryzen 7 5800xt ", 16 },
        { "ryzen 7 5825c ", 16 },
        { "ryzen 7 5825u ", 16 },
        { "ryzen 7 6800h ", 16 },
        { "ryzen 7 6800hs ", 16 },
        { "ryzen 7 6800u ", 16 },
        { "ryzen 7 7435hs ", 16 },
        { "ryzen 7 7700 ", 16 },
        { "ryzen 7 7700x ", 16 },
        { "ryzen 7 7730u ", 16 },
        { "ryzen 7 7735hs ", 16 },
        { "ryzen 7 7735u ", 16 },
        { "ryzen 7 7736u ", 16 },
        { "ryzen 7 7745hx ", 16 },
        { "ryzen 7 7800x3d ", 16 },
        { "ryzen 7 7840hs ", 16 },
        { "ryzen 7 7840hx ", 24 },
        { "ryzen 7 7840u ", 16 },
        { "ryzen 7 8700f ", 16 },
        { "ryzen 7 8700g ", 16 },
        { "ryzen 7 8840hs ", 16 },
        { "ryzen 7 8840u ", 16 },
        { "ryzen 7 8845hs ", 16 },
        { "ryzen 7 9700x ", 16 },
        { "ryzen 7 9800x3d ", 16 },
        { "ryzen 7 pro 1700 ", 16 },
        { "ryzen 7 pro 1700x ", 16 },
        { "ryzen 7 pro 250 ", 16 },
        { "ryzen 7 pro 2700 ", 16 },
        { "ryzen 7 pro 2700u ", 8 },
        { "ryzen 7 pro 2700x ", 16 },
        { "ryzen 7 pro 3700 ", 16 },
        { "ryzen 7 pro 3700u ", 8 },
        { "ryzen 7 pro 4750g ", 16 },
        { "ryzen 7 pro 4750ge ", 16 },
        { "ryzen 7 pro 4750u ", 16 },
        { "ryzen 7 pro 5750g ", 16 },
        { "ryzen 7 pro 5750ge ", 16 },
        { "ryzen 7 pro 5755g ", 16 },
        { "ryzen 7 pro 5755ge ", 16 },
        { "ryzen 7 pro 5845 ", 16 },
        { "ryzen 7 pro 5850u ", 16 },
        { "ryzen 7 pro 5875u ", 16 },
        { "ryzen 7 pro 6850h ", 16 },
        { "ryzen 7 pro 6850hs ", 16 },
        { "ryzen 7 pro 6850u ", 16 },
        { "ryzen 7 pro 6860z ", 16 },
        { "ryzen 7 pro 7730u ", 16 },
        { "ryzen 7 pro 7735u ", 16 },
        { "ryzen 7 pro 7745 ", 16 },
        { "ryzen 7 pro 7840hs ", 16 },
        { "ryzen 7 pro 7840u ", 16 },
        { "ryzen 7 pro 8700g ", 16 },
        { "ryzen 7 pro 8700ge ", 16 },
        { "ryzen 7 pro 8840hs ", 16 },
        { "ryzen 7 pro 8840u ", 16 },
        { "ryzen 7 pro 8845hs ", 16 },
        { "ryzen 9 270 ", 16 },
        { "ryzen 9 3900 processor ", 24 },
        { "ryzen 9 3900x ", 24 },
        { "ryzen 9 3900xt ", 24 },
        { "ryzen 9 3950x ", 32 },
        { "ryzen 9 4900h ", 16 },
        { "ryzen 9 4900hs ", 16 },
        { "ryzen 9 5900 ", 24 },
        { "ryzen 9 5900hs ", 16 },
        { "ryzen 9 5900hx ", 16 },
        { "ryzen 9 5900x ", 24 },
        { "ryzen 9 5900xt ", 32 },
        { "ryzen 9 5950x ", 32 },
        { "ryzen 9 5980hs ", 16 },
        { "ryzen 9 5980hx ", 16 },
        { "ryzen 9 6900hs ", 16 },
        { "ryzen 9 6900hx ", 16 },
        { "ryzen 9 6980hs ", 16 },
        { "ryzen 9 6980hx ", 16 },
        { "ryzen 9 7845hx ", 24 },
        { "ryzen 9 7900 ", 24 },
        { "ryzen 9 7900x ", 24 },
        { "ryzen 9 7900x3d ", 24 },
        { "ryzen 9 7940hs ", 16 },
        { "ryzen 9 7940hx ", 32 },
        { "ryzen 9 7945hx ", 32 },
        { "ryzen 9 7945hx3d ", 32 },
        { "ryzen 9 7950x ", 32 },
        { "ryzen 9 7950x3d ", 32 },
        { "ryzen 9 8945hs ", 16 },
        { "ryzen 9 9850hx ", 24 },
        { "ryzen 9 9900x ", 24 },
        { "ryzen 9 9900x3d ", 24 },
        { "ryzen 9 9950x ", 32 },
        { "ryzen 9 9950x3d ", 32 },
        { "ryzen 9 9955hx ", 32 },
        { "ryzen 9 9955hx3d ", 32 },
        { "ryzen 9 pro 3900 ", 24 },
        { "ryzen 9 pro 5945 ", 24 },
        { "ryzen 9 pro 6950h ", 16 },
        { "ryzen 9 pro 6950hs ", 16 },
        { "ryzen 9 pro 7940hs ", 16 },
        { "ryzen 9 pro 7945 ", 24 },
        { "ryzen 9 pro 8945hs ", 16 },
        { "ryzen threadripper 1900x ", 16 },
        { "ryzen threadripper 1920x ", 24 },
        { "ryzen threadripper 1950x ", 32 },
        { "ryzen threadripper 2920x ", 24 },
        { "ryzen threadripper 2950x ", 32 },
        { "ryzen threadripper 2970wx ", 48 },
        { "ryzen threadripper 2990wx ", 64 },
        { "ryzen threadripper 3960x ", 48 },
        { "ryzen threadripper 3970x ", 64 },
        { "ryzen threadripper 3990x ", 128 },
        { "ryzen threadripper 7960x ", 48 },
        { "ryzen threadripper 7970x ", 64 },
        { "ryzen threadripper 7980x ", 128 },
        { "ryzen threadripper pro 3945wx ", 24 },
        { "ryzen threadripper pro 3955wx ", 32 },
        { "ryzen threadripper pro 3975wx ", 64 },
        { "ryzen threadripper pro 3995wx ", 128 },
        { "ryzen threadripper pro 5945wx ", 24 },
        { "ryzen threadripper pro 5955wx ", 32 },
        { "ryzen threadripper pro 5965wx ", 48 },
        { "ryzen threadripper pro 5975wx ", 64 },
        { "ryzen threadripper pro 5995wx ", 128 },
        { "ryzen threadripper pro 7945wx ", 24 },
        { "ryzen threadripper pro 7955wx ", 32 },
        { "ryzen threadripper pro 7965wx ", 48 },
        { "ryzen threadripper pro 7975wx ", 64 },
        { "ryzen threadripper pro 7985wx ", 128 },
        { "ryzen threadripper pro 7995wx ", 192 },
        { "ryzen z1 extreme ", 16 },
        { "ryzen z1 ", 12 },
        { "sempron 2650 ", 2 },
        { "sempron 3850 ", 4 },
        { "x940 ", 4 },
        { "z2 extreme ", 16 },
        { "z2 go ", 8 }
    } };

    for (const auto& pair : amd_thread_database) {
        if (model.find(pair.first) != std::string::npos) {
            debug("AMD_THREAD_MISMATCH: Found CPU in database with ", pair.second, " threads");
            return std::thread::hardware_concurrency() != static_cast<unsigned>(pair.second);
        }
    }

    return false;
#endif
}